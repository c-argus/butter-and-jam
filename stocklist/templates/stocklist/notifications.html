{% extends 'base.html' %}
{% load static %}

{% block title %}Notifications - Butter and Jam{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'styles/notifications.css' %}">
{% endblock %}

{% block content %}
<div class="container footer-container">
    <div class="content mt-5">
        <h3>Notifications</h3>
        {% if notifications %}
        <div class="table-responsive">
            <table class="table align-middle mb-0 bg-white">
                <thead class="bg-light">
                    <tr>
                        <th scope="col">Item Name</th>
                        <th scope="col">Message</th>
                        <th scope="col">Created At</th>
                        <th scope="col">Status</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for notification in notifications %}
                    <tr>
                        <td scope="row">{{ notification.item.name }}</td>
                        <td scope="row">{{ notification.message }}</td>
                        <td scope="row"><span class="date">{{ notification.created_at }}</span></td>
                        <td scope="row">
                            {% if notification.read %}
                            <span class="statusRead badge badge-success rounded-pill d-inline">Read</span>
                            {% else %}
                            <span class="statusUnread badge badge-warning rounded-pill d-inline">Unread</span>
                            {% endif %}
                        </td>
                        <td scope="row">
                            <button class="markAsReadButton btn btn-link btn-sm btn-rounded"
                                data-id="{{notification.id}}">Mark as read</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No notifications available</p>
        {% endif %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        'use strict';
        console.log('Ready!');
        const buttonEls = Array.from(document.querySelectorAll('.markAsReadButton'));
        buttonEls.forEach(function (buttonEl) {
            buttonEl.addEventListener('click', async function (e) {
                console.log('markAsReadButton!!');
                const notificationId = e.target.dataset.id;
                try {
                    const response = await fetch(`/notifications/mark_as_read/${notificationId}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    if (response.ok) {
                        location.reload();
                    } else {
                        console.error('Error marking as read');
                    }
                } catch (error) {
                    console.error('Fetch error:', error);
                }
            });
        });
    });
</script>
{% endblock %}